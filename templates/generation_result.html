<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆç»“æœ - {{ level2.level1.name }} / {{ level2.name }}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }

    .breadcrumb {
      font-size: 14px;
      color: #666;
    }

    .breadcrumb a {
      color: #2196F3;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .scenario-info {
      background: #fff9e6;
      border-left: 4px solid #ff9800;
      padding: 16px 20px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .scenario-info h3 {
      font-size: 14px;
      color: #e65100;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .scenario-info p {
      font-size: 14px;
      color: #666;
      white-space: pre-wrap;
    }

    .seed-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    .seed-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e0e0e0;
    }

    .seed-icon {
      background: #4CAF50;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      flex-shrink: 0;
    }

    .seed-content {
      flex: 1;
    }

    .seed-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .seed-text {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      color: #333;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .generated-list {
      margin-top: 16px;
    }

    .generated-item {
      background: #fafafa;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
      transition: all 0.2s;
    }

    .generated-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .item-number {
      background: #2196F3;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .item-actions {
      display: none;
      gap: 8px;
    }

    .edit-mode .item-actions {
      display: flex;
    }

    .btn {
      padding: 6px 16px;
      border: none;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }

    .btn-edit {
      background: #2196F3;
      color: white;
    }

    .btn-edit:hover {
      background: #1976D2;
    }

    .btn-regenerate {
      background: #ff9800;
      color: white;
    }

    .btn-regenerate:hover {
      background: #f57c00;
    }

    .btn-save-item {
      background: #4CAF50;
      color: white;
      display: none;
    }

    .btn-save-item:hover {
      background: #45a049;
    }

    .btn-cancel-item {
      background: #9e9e9e;
      color: white;
      display: none;
    }

    .btn-cancel-item:hover {
      background: #757575;
    }

    .item-content {
      font-size: 14px;
      color: #333;
      line-height: 1.8;
      white-space: pre-wrap;
      padding: 12px;
      background: white;
      border-radius: 4px;
      min-height: 60px;
    }

    .item-edit-box {
      display: none;
      width: 100%;
      min-height: 100px;
      padding: 12px;
      border: 2px solid #2196F3;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.8;
      resize: vertical;
    }

    .item-edit-box:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    }

    .item-status {
      display: none;
      margin-top: 8px;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
    }

    .status-edited {
      background: #e3f2fd;
      color: #1976D2;
      border-left: 3px solid #2196F3;
    }

    .status-regenerated {
      background: #fff3e0;
      color: #e65100;
      border-left: 3px solid #ff9800;
    }

    .bottom-toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      padding: 16px 20px;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .toolbar-info {
      font-size: 14px;
      color: #666;
    }

    .toolbar-actions {
      display: flex;
      gap: 12px;
    }

    .btn-large {
      padding: 12px 32px;
      font-size: 15px;
      font-weight: 600;
    }

    .btn-toggle-edit {
      background: #2196F3;
      color: white;
    }

    .btn-toggle-edit:hover {
      background: #1976D2;
    }

    .btn-toggle-edit.active {
      background: #9e9e9e;
    }

    .btn-toggle-edit.active:hover {
      background: #757575;
    }

    .btn-save-modifications {
      background: #4CAF50;
      color: white;
    }

    .btn-save-modifications:hover {
      background: #45a049;
    }

    .btn-final-save {
      background: #2196F3;
      color: white;
    }

    .btn-final-save:hover {
      background: #1976D2;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    /* æ¶ˆæ¯æç¤º */
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    .message-success {
      background: #4CAF50;
      color: white;
    }

    .message-error {
      background: #f44336;
      color: white;
    }

    .message-info {
      background: #2196F3;
      color: white;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateX(400px);
      }
    }

    .message.fade-out {
      animation: fadeOut 0.3s ease-out forwards;
    }

    /* åŠ è½½çŠ¶æ€ */
    .regenerating {
      opacity: 0.6;
      pointer-events: none;
      position: relative;
    }

    .regenerating::after {
      content: "é‡æ–°ç”Ÿæˆä¸­...";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 152, 0, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div class="breadcrumb">
        <a href="{% url 'Generate_testcases:testcase_workspace' %}">â† è¿”å›å·¥ä½œå°</a>
      </div>
      <h1>{{ level2.level1.name }} / {{ level2.name }}</h1>
    </div>

    <!-- åœºæ™¯æç¤ºè¯ -->
    {% if level2.prompt %}
    <div class="scenario-info">
      <h3>åœºæ™¯æç¤ºè¯</h3>
      <p>{{ level2.prompt }}</p>
    </div>
    {% endif %}

    <!-- ç”Ÿæˆç»“æœ -->
    {% if session and items_by_seed %}
      {% for seed, items in items_by_seed.items %}
      <div class="seed-section">
        <div class="seed-header">
          <div class="seed-icon">{{ forloop.counter }}</div>
          <div class="seed-content">
            <div class="seed-label">ç§å­æµ‹è¯•ç”¨ä¾‹ #{{ seed.id }}</div>
            <div class="seed-text">{{ seed.text }}</div>
          </div>
        </div>

        <div class="generated-list">
          {% for item in items %}
          <div class="generated-item" data-item-id="{{ item.id }}" data-original-text="{{ item.final_text }}">
            <div class="item-header">
              <span class="item-number">æ³›åŒ–ç”¨ä¾‹ #{{ forloop.counter }}</span>
              <div class="item-actions">
                <button class="btn btn-edit" onclick="editItem({{ item.id }})">ç¼–è¾‘</button>
                <button class="btn btn-regenerate" onclick="regenerateItem({{ item.id }}, {{ seed.id }})">é‡æ–°ç”Ÿæˆ</button>
                <button class="btn btn-save-item" onclick="saveItemEdit({{ item.id }})">ä¿å­˜</button>
                <button class="btn btn-cancel-item" onclick="cancelItemEdit({{ item.id }})">å–æ¶ˆ</button>
              </div>
            </div>
            <div class="item-content" id="content-{{ item.id }}">{{ item.final_text }}</div>
            <textarea class="item-edit-box" id="edit-{{ item.id }}">{{ item.final_text }}</textarea>
            <div class="item-status" id="status-{{ item.id }}"></div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ“‹</div>
      <p>æš‚æ— ç”Ÿæˆç»“æœ</p>
    </div>
    {% endif %}

    <!-- åº•éƒ¨å ä½ï¼Œé¿å…è¢«å›ºå®šå·¥å…·æ é®æŒ¡ -->
    <div style="height: 80px;"></div>
  </div>

  <!-- åº•éƒ¨å·¥å…·æ  -->
  <div class="bottom-toolbar">
    <div class="toolbar-info">
      å…± <strong id="totalCount">{{ total_count }}</strong> æ¡æ³›åŒ–ç”¨ä¾‹
      <span id="modifiedCount" style="display: none; margin-left: 16px; color: #ff9800;">
        å·²ä¿®æ”¹ <strong>0</strong> æ¡
      </span>
    </div>
    <div class="toolbar-actions">
      <button class="btn btn-large btn-toggle-edit" id="toggleEditBtn" onclick="toggleEditMode()">
        è¿›å…¥ä¿®æ”¹æ¨¡å¼
      </button>
      <button class="btn btn-large btn-save-modifications" id="saveModificationsBtn" onclick="saveModifications()" style="display: none;">
        ä¿å­˜ä¿®æ”¹
      </button>
      <button class="btn btn-large btn-final-save" id="finalSaveBtn" onclick="saveToFinalTable()">
        ä¿å­˜æ³›åŒ–æµ‹è¯•ç”¨ä¾‹
      </button>
    </div>
  </div>

  <script>
    const csrfToken = '{{ csrf_token }}';
    const sessionId = {{ session.id|default:'null' }};
    let editMode = false;
    let modifiedItems = new Map(); // å­˜å‚¨ä¿®æ”¹çš„å†…å®¹

    // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
    function toggleEditMode() {
      editMode = !editMode;
      const container = document.querySelector('.container');
      const toggleBtn = document.getElementById('toggleEditBtn');
      const saveModBtn = document.getElementById('saveModificationsBtn');
      const finalSaveBtn = document.getElementById('finalSaveBtn');

      if (editMode) {
        // è¿›å…¥ä¿®æ”¹æ¨¡å¼
        container.classList.add('edit-mode');
        toggleBtn.textContent = 'é€€å‡ºä¿®æ”¹æ¨¡å¼';
        toggleBtn.classList.add('active');
        saveModBtn.style.display = 'inline-block';  // æ˜¾ç¤º"ä¿å­˜ä¿®æ”¹"æŒ‰é’®
        finalSaveBtn.style.display = 'none';  // éšè—"ä¿å­˜æ³›åŒ–æµ‹è¯•ç”¨ä¾‹"æŒ‰é’®
      } else {
        // é€€å‡ºä¿®æ”¹æ¨¡å¼
        container.classList.remove('edit-mode');
        toggleBtn.textContent = 'è¿›å…¥ä¿®æ”¹æ¨¡å¼';
        toggleBtn.classList.remove('active');
        saveModBtn.style.display = 'none';  // éšè—"ä¿å­˜ä¿®æ”¹"æŒ‰é’®
        finalSaveBtn.style.display = 'inline-block';  // æ˜¾ç¤º"ä¿å­˜æ³›åŒ–æµ‹è¯•ç”¨ä¾‹"æŒ‰é’®
        
        // å–æ¶ˆæ‰€æœ‰æœªä¿å­˜çš„ç¼–è¾‘
        document.querySelectorAll('.generated-item').forEach(item => {
          const itemId = item.dataset.itemId;
          cancelItemEdit(itemId);
        });
      }
    }

    // ç¼–è¾‘å•æ¡ç”¨ä¾‹
    function editItem(itemId) {
      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      const content = document.getElementById(`content-${itemId}`);
      const editBox = document.getElementById(`edit-${itemId}`);
      const actions = item.querySelector('.item-actions');

      content.style.display = 'none';
      editBox.style.display = 'block';
      editBox.focus();

      // åˆ‡æ¢æŒ‰é’®
      actions.querySelector('.btn-edit').style.display = 'none';
      actions.querySelector('.btn-regenerate').style.display = 'none';
      actions.querySelector('.btn-save-item').style.display = 'inline-block';
      actions.querySelector('.btn-cancel-item').style.display = 'inline-block';
    }

    // ä¿å­˜å•æ¡ç¼–è¾‘ï¼ˆä¸´æ—¶ä¿å­˜åˆ°å†…å­˜ï¼‰
    function saveItemEdit(itemId) {
      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      const content = document.getElementById(`content-${itemId}`);
      const editBox = document.getElementById(`edit-${itemId}`);
      const status = document.getElementById(`status-${itemId}`);
      const actions = item.querySelector('.item-actions');

      const newText = editBox.value.trim();
      
      if (!newText) {
        showMessage('ç”¨ä¾‹å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
        return;
      }

      // æ›´æ–°æ˜¾ç¤º
      content.textContent = newText;
      content.style.display = 'block';
      editBox.style.display = 'none';

      // ä¿å­˜åˆ°æœ¬åœ°çŠ¶æ€
      modifiedItems.set(itemId, {
        type: 'edit',
        text: newText,
        original: item.dataset.originalText
      });

      // æ˜¾ç¤ºçŠ¶æ€
      status.textContent = 'âœ“ å·²ç¼–è¾‘ï¼ˆæœªä¿å­˜åˆ°æ•°æ®åº“ï¼‰';
      status.className = 'item-status status-edited';
      status.style.display = 'block';

      // åˆ‡æ¢æŒ‰é’®
      actions.querySelector('.btn-edit').style.display = 'inline-block';
      actions.querySelector('.btn-regenerate').style.display = 'inline-block';
      actions.querySelector('.btn-save-item').style.display = 'none';
      actions.querySelector('.btn-cancel-item').style.display = 'none';

      updateModifiedCount();
    }

    // å–æ¶ˆå•æ¡ç¼–è¾‘
    function cancelItemEdit(itemId) {
      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      const content = document.getElementById(`content-${itemId}`);
      const editBox = document.getElementById(`edit-${itemId}`);
      const status = document.getElementById(`status-${itemId}`);
      const actions = item.querySelector('.item-actions');

      // æ¢å¤åŸå§‹æ–‡æœ¬
      const modified = modifiedItems.get(itemId);
      if (modified) {
        editBox.value = modified.original;
        modifiedItems.delete(itemId);
        status.style.display = 'none';
      } else {
        editBox.value = content.textContent;
      }

      content.style.display = 'block';
      editBox.style.display = 'none';

      // åˆ‡æ¢æŒ‰é’®
      actions.querySelector('.btn-edit').style.display = 'inline-block';
      actions.querySelector('.btn-regenerate').style.display = 'inline-block';
      actions.querySelector('.btn-save-item').style.display = 'none';
      actions.querySelector('.btn-cancel-item').style.display = 'none';

      updateModifiedCount();
    }

    // é‡æ–°ç”Ÿæˆå•æ¡ç”¨ä¾‹
    async function regenerateItem(itemId, seedId) {
      if (!confirm('ç¡®å®šè¦é‡æ–°ç”Ÿæˆè¿™æ¡ç”¨ä¾‹å—ï¼ŸåŸå†…å®¹å°†è¢«æ›¿æ¢ã€‚')) {
        return;
      }

      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      const content = document.getElementById(`content-${itemId}`);
      const status = document.getElementById(`status-${itemId}`);

      item.classList.add('regenerating');

      try {
        const response = await fetch('/Generate_testcases/api/regenerate-item/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
          },
          body: JSON.stringify({
            item_id: itemId,
            seed_id: seedId
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }

        // â­ å…³é”®ä¿®å¤ï¼šæ›´æ–°DOMå…ƒç´ çš„data-item-idä¸ºæ–°çš„item_id
        const newItemId = data.item_id;
        
        // æ›´æ–°æ‰€æœ‰ç›¸å…³çš„IDå¼•ç”¨
        item.setAttribute('data-item-id', newItemId);
        content.id = `content-${newItemId}`;
        document.getElementById(`edit-${itemId}`).id = `edit-${newItemId}`;
        status.id = `status-${newItemId}`;
        
        // æ›´æ–°æŒ‰é’®çš„onclickå±æ€§
        const editBtn = item.querySelector('.btn-edit');
        const regenBtn = item.querySelector('.btn-regenerate');
        const saveBtn = item.querySelector('.btn-save-item');
        const cancelBtn = item.querySelector('.btn-cancel-item');
        
        editBtn.setAttribute('onclick', `editItem(${newItemId})`);
        regenBtn.setAttribute('onclick', `regenerateItem(${newItemId}, ${seedId})`);
        saveBtn.setAttribute('onclick', `saveItemEdit(${newItemId})`);
        cancelBtn.setAttribute('onclick', `cancelItemEdit(${newItemId})`);

        // æ›´æ–°æ˜¾ç¤ºå†…å®¹
        content.textContent = data.new_text;
        document.getElementById(`edit-${newItemId}`).value = data.new_text;
        
        // æ›´æ–°originalText
        item.dataset.originalText = data.new_text;

        // ä¿å­˜åˆ°æœ¬åœ°çŠ¶æ€ï¼ˆä½¿ç”¨æ–°çš„itemIdï¼‰
        modifiedItems.delete(itemId);  // åˆ é™¤æ—§çš„è®°å½•
        modifiedItems.set(newItemId, {
          type: 'regenerate',
          text: data.new_text,
          original: data.new_text
        });

        // æ˜¾ç¤ºçŠ¶æ€
        status.textContent = 'âœ“ å·²é‡æ–°ç”Ÿæˆï¼ˆæœªä¿å­˜åˆ°æ•°æ®åº“ï¼‰';
        status.className = 'item-status status-regenerated';
        status.style.display = 'block';

        showMessage('é‡æ–°ç”ŸæˆæˆåŠŸ', 'success');
        updateModifiedCount();

      } catch (error) {
        showMessage('é‡æ–°ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
      } finally {
        item.classList.remove('regenerating');
      }
    }

    // ä¿å­˜ä¿®æ”¹åˆ° GenerationItem è¡¨ï¼ˆä¸´æ—¶å·¥ä½œåŒºï¼‰
    async function saveModifications() {
      if (modifiedItems.size === 0) {
        showMessage('æ²¡æœ‰éœ€è¦ä¿å­˜çš„ä¿®æ”¹', 'info');
        return;
      }

      if (!confirm(`ç¡®å®šè¦ä¿å­˜ ${modifiedItems.size} æ¡ä¿®æ”¹åˆ°ä¸´æ—¶å·¥ä½œåŒºå—ï¼Ÿ`)) {
        return;
      }

      const updates = [];
      modifiedItems.forEach((value, itemId) => {
        updates.push({
          item_id: parseInt(itemId),
          text: value.text,
          type: value.type
        });
      });

      try {
        const response = await fetch('/Generate_testcases/api/save-all-edits/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
          },
          body: JSON.stringify({
            session_id: sessionId,
            updates: updates
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }

        showMessage(`âœ… ä¿®æ”¹æˆåŠŸï¼å·²æ›´æ–° ${data.saved_count} æ¡ç”¨ä¾‹`, 'success');
        
        // æ¸…ç©ºæœ¬åœ°çŠ¶æ€
        modifiedItems.clear();
        
        // éšè—æ‰€æœ‰çŠ¶æ€æ ‡ç­¾
        document.querySelectorAll('.item-status').forEach(el => {
          el.style.display = 'none';
        });

        // æ›´æ–°åŸå§‹æ–‡æœ¬
        updates.forEach(update => {
          const item = document.querySelector(`[data-item-id="${update.item_id}"]`);
          if (item) {
            item.dataset.originalText = update.text;
          }
        });

        updateModifiedCount();

      } catch (error) {
        showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
      }
    }

    // ä¿å­˜åˆ°æœ€ç»ˆè¡¨ SavedCaseItemï¼ˆæ­£å¼åº“ï¼‰
    async function saveToFinalTable() {
      if (!confirm('ç¡®å®šè¦å°†å½“å‰æµ‹è¯•ç”¨ä¾‹ä¿å­˜åˆ°æœ€ç»ˆåº“å—ï¼Ÿ\n\nè¿™å°†åˆ›å»ºä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ï¼Œå¯ç”¨äºæµ‹è¯•æ‰§è¡Œã€‚')) {
        return;
      }

      // å¼¹å‡ºç‰ˆæœ¬åç§°è¾“å…¥æ¡†
      const versionTitle = prompt('è¯·è¾“å…¥ç‰ˆæœ¬åç§°ï¼ˆå¯é€‰ï¼‰ï¼š', '');

      try {
        const response = await fetch('/Generate_testcases/api/save-to-final/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
          },
          body: JSON.stringify({
            session_id: sessionId,
            title: versionTitle || '',
            status: 'confirmed'
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }

        showMessage(`ğŸ‰ ${data.message}`, 'success');
        
        // 2ç§’åå¯ä»¥é€‰æ‹©è·³è½¬æˆ–åˆ·æ–°
        setTimeout(() => {
          if (confirm('ä¿å­˜æˆåŠŸï¼æ˜¯å¦è¿”å›å·¥ä½œå°ï¼Ÿ')) {
            window.location.href = "{% url 'Generate_testcases:testcase_workspace' %}";
          }
        }, 2000);

      } catch (error) {
        showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
      }
    }

    // æ›´æ–°ä¿®æ”¹è®¡æ•°
    function updateModifiedCount() {
      const countEl = document.getElementById('modifiedCount');
      const count = modifiedItems.size;
      
      if (count > 0) {
        countEl.style.display = 'inline';
        countEl.querySelector('strong').textContent = count;
      } else {
        countEl.style.display = 'none';
      }
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, type = 'info') {
      const message = document.createElement('div');
      message.className = `message message-${type}`;
      message.textContent = text;
      document.body.appendChild(message);

      setTimeout(() => {
        message.classList.add('fade-out');
        setTimeout(() => message.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>
